<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Untitled</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="austen_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="austen_R_files/libs/quarto-html/quarto.js"></script>
<script src="austen_R_files/libs/quarto-html/popper.min.js"></script>
<script src="austen_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="austen_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="austen_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="austen_R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="austen_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="austen_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="austen_R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Untitled</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>https://cran.r-project.org/web/packages/spacyr/vignettes/using_spacyr.html</p>
<p>Netværk, evt geokodning af Austen romaner.</p>
<p>Why Austen? Because everyone use her books for this kind of analyses.</p>
<p>They do that because she apparently is a pretty good author. And because her books give an insight into societal norms in Britain around the turn of the 18th to 19th centure. It probably doesn’t hurt that she was not a man.</p>
<p>That means that there is a very high probability that I can find analyses out there that provides some sort of ground truth. That will allow me to reassure myself that I’m doing something rigth.</p>
<section id="the-libraries" class="level1">
<h1>The libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'tidyverse' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'ggplot2' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'tibble' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'tidyr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'readr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'purrr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'dplyr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'stringr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'forcats' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'lubridate' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readtext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'readtext' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'tidytext' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spacyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'spacyr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janeaustenr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'janeaustenr' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'RcppRoll' blev bygget under R version 4.3.2</code></pre>
</div>
</div>
</section>
<section id="getting-the-books" class="level1">
<h1>Getting the books</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> <span class="fu">austen_books</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(books, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   text                    book               
   &lt;chr&gt;                   &lt;fct&gt;              
 1 "SENSE AND SENSIBILITY" Sense &amp; Sensibility
 2 ""                      Sense &amp; Sensibility
 3 "by Jane Austen"        Sense &amp; Sensibility
 4 ""                      Sense &amp; Sensibility
 5 "(1811)"                Sense &amp; Sensibility
 6 ""                      Sense &amp; Sensibility
 7 ""                      Sense &amp; Sensibility
 8 ""                      Sense &amp; Sensibility
 9 ""                      Sense &amp; Sensibility
10 "CHAPTER 1"             Sense &amp; Sensibility</code></pre>
</div>
</div>
</section>
<section id="getting-data-ready" class="level1">
<h1>Getting data ready</h1>
<p>We have one line of text in each row in the <em>text</em> column. I would prefer one sentence. We also have some front matter in each book, that we do not need. There is some chapter information. And in <em>Emma</em> there is more than one volume.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>books <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Emma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">13</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  text        book 
  &lt;chr&gt;       &lt;fct&gt;
1 ""          Emma 
2 "VOLUME I"  Emma 
3 ""          Emma 
4 ""          Emma 
5 ""          Emma 
6 "CHAPTER I" Emma 
7 ""          Emma </code></pre>
</div>
</div>
<p>Let us extract the volume and chapter information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">volume =</span> <span class="fu">case_when</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(text, <span class="st">"VOLUME"</span>) <span class="sc">~</span> text,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="cn">NA_character_</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">case_when</span>(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_starts</span>(text, <span class="st">"CHAPTER|Chapter"</span>) <span class="sc">~</span> text,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is some inconsistency in the data. In Pride &amp; Prejudice and in Persuasion, the chapters are written “Chapter”, whereas in the rest of the books, chapter is capitalized.</p>
<p>We need to get rid of everything before “Chapter 1” (or Chapter I in Mansfield Park and Emma?)</p>
<p>Grouping by book, filling the chapter column down but not up, and then removing all rows without chapter information does the trick. We need to start by handling volume information</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(volume, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(chapter, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(chapter)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, lets get rid of the chapter and volume headings, and any empty lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(text <span class="sc">!=</span> chapter) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">volume =</span> <span class="st">"1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(text <span class="sc">!=</span> volume) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(text <span class="sc">!=</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(books)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [61,977 × 4] (S3: tbl_df/tbl/data.frame)
 $ text   : chr [1:61977] "The family of Dashwood had long been settled in Sussex.  Their estate" "was large, and their residence was at Norland Park, in the centre of" "their property, where, for many generations, they had lived in so" "respectable a manner as to engage the general good opinion of their" ...
 $ book   : Factor w/ 6 levels "Sense &amp; Sensibility",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ volume : chr [1:61977] "1" "1" "1" "1" ...
 $ chapter: chr [1:61977] "CHAPTER 1" "CHAPTER 1" "CHAPTER 1" "CHAPTER 1" ...</code></pre>
</div>
</div>
<p>In <em>text</em> we have a line of text, rather than a sentence. The interesting unit of analysis is not an arbitrary line of text. But a sentence.</p>
<p>Let us get some sentences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book, volume, chapter) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sentences =</span> <span class="fu">paste0</span>(text, <span class="at">collapse =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'book', 'volume'. You can override using
the `.groups` argument.</code></pre>
</div>
</div>
<p>Now we have a dataframe with one chapter in each row.</p>
<p>If we do not handle it now, we will later discover that Austen sometimes uses “–” to indicate that someone new is speaking. Lets get rid of that now, rather than later:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentences =</span> <span class="fu">str_replace_all</span>(sentences, <span class="st">"--"</span>, <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It would be nice to have the volumnes and chapters in numerical order. We do that by removing “CHAPTER”, “Chapter” and “VOLUME” from the chapter and volume columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">str_remove</span>(chapter, <span class="st">"CHAPTER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">str_remove</span>(chapter, <span class="st">"Chapter"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">volume =</span> <span class="fu">str_remove</span>(volume, <span class="st">"VOLUME"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we just have to coerce chapter and volume to numbers. However:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>books <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(chapter) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] " 1"       " 10"      " 11"      " 12"      " 13"      " 14"     
  [7] " 15"      " 16"      " 17"      " 18"      " 19"      " 2"      
 [13] " 20"      " 21"      " 22"      " 23"      " 24"      " 25"     
 [19] " 26"      " 27"      " 28"      " 29"      " 3"       " 30"     
 [25] " 31"      " 32"      " 33"      " 34"      " 35"      " 36"     
 [31] " 37"      " 38"      " 39"      " 4"       " 40"      " 41"     
 [37] " 42"      " 43"      " 44"      " 45"      " 46"      " 47"     
 [43] " 48"      " 49"      " 5"       " 50"      " 6"       " 7"      
 [49] " 8"       " 9"       " 51"      " 52"      " 53"      " 54"     
 [55] " 55"      " 56"      " 57"      " 58"      " 59"      " 60"     
 [61] " 61"      " I"       " II"      " III"     " IV"      " IX"     
 [67] " V"       " VI"      " VII"     " VIII"    " X"       " XI"     
 [73] " XII"     " XIII"    " XIV"     " XIX"     " XL"      " XLI"    
 [79] " XLII"    " XLIII"   " XLIV"    " XLV"     " XLVI"    " XLVII"  
 [85] " XLVIII"  " XV"      " XVI"     " XVII"    " XVIII"   " XX"     
 [91] " XXI"     " XXII"    " XXIII"   " XXIV"    " XXIX"    " XXV"    
 [97] " XXVI"    " XXVII"   " XXVIII"  " XXX"     " XXXI"    " XXXII"  
[103] " XXXIII"  " XXXIV"   " XXXIX"   " XXXV"    " XXXVI"   " XXXVII" 
[109] " XXXVIII"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>chapter <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] " 1"       " 10"      " 11"      " 12"      " 13"      " 14"     
  [7] " 15"      " 16"      " 17"      " 18"      " 19"      " 2"      
 [13] " 20"      " 21"      " 22"      " 23"      " 24"      " 25"     
 [19] " 26"      " 27"      " 28"      " 29"      " 3"       " 30"     
 [25] " 31"      " 32"      " 33"      " 34"      " 35"      " 36"     
 [31] " 37"      " 38"      " 39"      " 4"       " 40"      " 41"     
 [37] " 42"      " 43"      " 44"      " 45"      " 46"      " 47"     
 [43] " 48"      " 49"      " 5"       " 50"      " 6"       " 7"      
 [49] " 8"       " 9"       " 51"      " 52"      " 53"      " 54"     
 [55] " 55"      " 56"      " 57"      " 58"      " 59"      " 60"     
 [61] " 61"      " I"       " II"      " III"     " IV"      " IX"     
 [67] " V"       " VI"      " VII"     " VIII"    " X"       " XI"     
 [73] " XII"     " XIII"    " XIV"     " XIX"     " XL"      " XLI"    
 [79] " XLII"    " XLIII"   " XLIV"    " XLV"     " XLVI"    " XLVII"  
 [85] " XLVIII"  " XV"      " XVI"     " XVII"    " XVIII"   " XX"     
 [91] " XXI"     " XXII"    " XXIII"   " XXIV"    " XXIX"    " XXV"    
 [97] " XXVI"    " XXVII"   " XXVIII"  " XXX"     " XXXI"    " XXXII"  
[103] " XXXIII"  " XXXIV"   " XXXIX"   " XXXV"    " XXXVI"   " XXXVII" 
[109] " XXXVIII"</code></pre>
</div>
</div>
<p>Looking at these two columns, we discover that some of the chapter (and volume) numbers are in roman numerals.</p>
<p>Roman numerals (and whitespace at the beginning). Looking at these two columns, we discover that some of the chapter (and volume) numbers are in roman numerals.</p>
<p>The utils-package has an as.roman function. It can read both roman numerals (as text), and numbers (both as numeric and as text) and return an object of class “roman”. Which has the type of numeric:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">as.roman</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">as.roman</span>(<span class="st">"III"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>One detail. There are whitespaces in the roman numerals we already have, and that messes up the coercion:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">volume =</span> <span class="fu">str_trim</span>(volume)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">volume =</span> <span class="fu">as.numeric</span>(<span class="fu">as.roman</span>(volume))) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">str_trim</span>(chapter)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">as.numeric</span>(<span class="fu">as.roman</span>(chapter))) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(book, volume, chapter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a dataframe with one chapter pr row. Lets tokenize! (this is the point where my computer spins up the ventilator… But the task is not large enough to warrent trying to parallelise it) Eller også er den - for det tager noget længere tid på tærten. Det er furrr vi skal have fat på</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>sentences <span class="ot">&lt;-</span> books <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tokens =</span> <span class="fu">map</span>(sentences, spacy_parse))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>successfully initialized (spaCy Version: 3.7.2, language model: en_core_web_sm)</code></pre>
</div>
</div>
<p>DET ER MED en_core_web_sm.</p>
<p>hvad har vi ellers?</p>
<p>Hvordan får jeg indlæst den store, i stedet for den lille?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spacy_download_langmodel("en_core_web_lg")</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spacy_initialize</span>(<span class="at">model=</span><span class="st">'en_core_web_lg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>spaCy is already initialized</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>The result is placed in a list column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sentences) <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  tokens                
  &lt;list&gt;                
1 &lt;spcyr_pr [1,861 × 7]&gt;
2 &lt;spcyr_pr [2,401 × 7]&gt;
3 &lt;spcyr_pr [1,831 × 7]&gt;
4 &lt;spcyr_pr [2,325 × 7]&gt;
5 &lt;spcyr_pr [1,177 × 7]&gt;
6 &lt;spcyr_pr [1,542 × 7]&gt;</code></pre>
</div>
</div>
<p>We need to unnest that.</p>
<p>First of all, let us make that sentence dataframe a bit more easy to handle. It will also bring us one step closer to normalising the entire dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sentences <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(tokens) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(tokens) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,137 × 11
   book   volume chapter sentences doc_id sentence_id token_id token lemma pos  
   &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 Sense…      1       1 "The fam… text1            1        1 The   the   DET  
 2 Sense…      1       1 "The fam… text1            1        2 fami… fami… NOUN 
 3 Sense…      1       1 "The fam… text1            1        3 of    of    ADP  
 4 Sense…      1       1 "The fam… text1            1        4 Dash… Dash… PROPN
 5 Sense…      1       1 "The fam… text1            1        5 had   have  AUX  
 6 Sense…      1       1 "The fam… text1            1        6 long  long  ADV  
 7 Sense…      1       1 "The fam… text1            1        7 been  be    AUX  
 8 Sense…      1       1 "The fam… text1            1        8 sett… sett… VERB 
 9 Sense…      1       1 "The fam… text1            1        9 in    in    ADP  
10 Sense…      1       1 "The fam… text1            1       10 Suss… Suss… PROPN
# ℹ 11,127 more rows
# ℹ 1 more variable: entity &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(sentence_id:entity) </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> sentences <span class="sc">%&gt;%</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sentences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then we unnest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">unnest</span>(tokens, <span class="at">cols =</span> <span class="fu">c</span>(tokens))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  book       volume chapter doc_id sentence_id token_id token lemma pos   entity
  &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
1 Sense &amp; S…      1       1 text1            1        1 The   the   DET   ""    
2 Sense &amp; S…      1       1 text1            1        2 fami… fami… NOUN  ""    
3 Sense &amp; S…      1       1 text1            1        3 of    of    ADP   ""    
4 Sense &amp; S…      1       1 text1            1        4 Dash… Dash… PROPN "GPE_…
5 Sense &amp; S…      1       1 text1            1        5 had   have  AUX   ""    
6 Sense &amp; S…      1       1 text1            1        6 long  long  ADV   ""    </code></pre>
</div>
</div>
<p>It is a rather large dataframe now, taking up almost 72 Mb in memory. But not something a modern computer can handle - that is to say, I might want a more modern computer soon.</p>
<p>Some columns are not really needed now. Let us get rid of that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> tokens <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>doc_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What do we have to work with? The <em>token</em> column simply holds the words of the text. Combined with sentence.id (the number of that sentence in the chapter), and the token_id (the number of that token in that specific sentence), we are able to reconstruct the entire text.</p>
<p>lemma is the base form (lemmatized).</p>
<p>pos is “part of speach”, or word class.</p>
<p>entity is the named entity that spacyr recognizes. “Dashwood” eg, is a GPE_B, that is, a geopolitical entity. The “B” indicates that this word is at the beginning of the named entity. In this case we only have one word.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  book              volume chapter sentence_id token_id token lemma pos   entity
  &lt;fct&gt;              &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
1 Sense &amp; Sensibil…      1       1           1        1 The   the   DET   ""    
2 Sense &amp; Sensibil…      1       1           1        2 fami… fami… NOUN  ""    
3 Sense &amp; Sensibil…      1       1           1        3 of    of    ADP   ""    
4 Sense &amp; Sensibil…      1       1           1        4 Dash… Dash… PROPN "GPE_…
5 Sense &amp; Sensibil…      1       1           1        5 had   have  AUX   ""    
6 Sense &amp; Sensibil…      1       1           1        6 long  long  ADV   ""    </code></pre>
</div>
</div>
<p>What types of pos do we have?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(pos) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "DET"   "NOUN"  "ADP"   "PROPN" "AUX"   "ADV"   "VERB"  "PUNCT" "SPACE"
[10] "PRON"  "ADJ"   "CCONJ" "SCONJ" "PART"  "NUM"   "INTJ"  "X"     "SYM"  </code></pre>
</div>
</div>
<p>Or, in a nice table:</p>
<table class="table">
<thead>
<tr class="header">
<th>POS Tag</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SPACE</td>
<td>Space character or whitespace</td>
</tr>
<tr class="even">
<td>DET</td>
<td>Determiner (e.g., “a”, “the”)</td>
</tr>
<tr class="odd">
<td>NOUN</td>
<td>Noun (e.g., “cat”, “table”)</td>
</tr>
<tr class="even">
<td>ADP</td>
<td>Adposition (e.g., prepositions and postpositions)</td>
</tr>
<tr class="odd">
<td>PROPN</td>
<td>Proper Noun (e.g., “John”, “London”)</td>
</tr>
<tr class="even">
<td>AUX</td>
<td>Auxiliary verb (e.g., “is”, “has”)</td>
</tr>
<tr class="odd">
<td>ADV</td>
<td>Adverb (e.g., “quickly”, “very”)</td>
</tr>
<tr class="even">
<td>VERB</td>
<td>Verb (e.g., “run”, “speak”)</td>
</tr>
<tr class="odd">
<td>PUNCT</td>
<td>Punctuation (e.g., “.”, “!”)</td>
</tr>
<tr class="even">
<td>PRON</td>
<td>Pronoun (e.g., “he”, “they”)</td>
</tr>
<tr class="odd">
<td>ADJ</td>
<td>Adjective (e.g., “big”, “red”)</td>
</tr>
<tr class="even">
<td>CCONJ</td>
<td>Coordinating conjunction (e.g., “and”, “but”)</td>
</tr>
<tr class="odd">
<td>SCONJ</td>
<td>Subordinating conjunction (e.g., “although”, “if”)</td>
</tr>
<tr class="even">
<td>PART</td>
<td>Particle (e.g., “not”, “out” in “out in”)</td>
</tr>
<tr class="odd">
<td>NUM</td>
<td>Numeral (e.g., “one”, “2024”)</td>
</tr>
<tr class="even">
<td>INTJ</td>
<td>Interjection (e.g., “oh”, “wow”)</td>
</tr>
<tr class="odd">
<td>X</td>
<td>Other: foreign words, typos, etc.</td>
</tr>
<tr class="even">
<td>SYM</td>
<td>Symbol (e.g., “$”, “@”)</td>
</tr>
</tbody>
</table>
<p>And now we get to the part where my language skills are very weak. Not only in English, but also in Danish. I have no instinctual feeling about what an adverb is.</p>
<p>We also had some entities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(entity) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ""              "GPE_B"         "FAC_B"         "FAC_I"        
 [5] "DATE_B"        "DATE_I"        "PERSON_B"      "PERSON_I"     
 [9] "ORG_B"         "CARDINAL_B"    "QUANTITY_B"    "QUANTITY_I"   
[13] "ORDINAL_B"     "CARDINAL_I"    "TIME_B"        "TIME_I"       
[17] "GPE_I"         "ORG_I"         "WORK_OF_ART_B" "LOC_B"        
[21] "LOC_I"         "NORP_B"        "WORK_OF_ART_I" "MONEY_B"      
[25] "MONEY_I"       "PRODUCT_B"     "EVENT_B"       "NORP_I"       
[29] "PRODUCT_I"     "LANGUAGE_B"    "LAW_B"         "LAW_I"        </code></pre>
</div>
</div>
<p>Or, in a nice table:</p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th>NER Tag</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(empty string)</td>
<td>No entity detected</td>
</tr>
<tr class="even">
<td>CARDINAL_B</td>
<td>Beginning of a Cardinal number</td>
</tr>
<tr class="odd">
<td>CARDINAL_I</td>
<td>Inside a Cardinal number</td>
</tr>
<tr class="even">
<td>DATE_B</td>
<td>Beginning of a Date</td>
</tr>
<tr class="odd">
<td>DATE_I</td>
<td>Inside a Date</td>
</tr>
<tr class="even">
<td>EVENT_B</td>
<td>Beginning of an Event</td>
</tr>
<tr class="odd">
<td>FAC_B</td>
<td>Beginning of a Facility</td>
</tr>
<tr class="even">
<td>FAC_I</td>
<td>Inside a Facility</td>
</tr>
<tr class="odd">
<td>GPE_B</td>
<td>Beginning of a Geopolitical Entity</td>
</tr>
<tr class="even">
<td>GPE_I</td>
<td>Inside a Geopolitical Entity</td>
</tr>
<tr class="odd">
<td>LANGUAGE_B</td>
<td>Beginning of a Language</td>
</tr>
<tr class="even">
<td>LAW_B</td>
<td>Beginning of a Law</td>
</tr>
<tr class="odd">
<td>LAW_I</td>
<td>Inside a Law</td>
</tr>
<tr class="even">
<td>LOC_B</td>
<td>Beginning of a Location</td>
</tr>
<tr class="odd">
<td>LOC_I</td>
<td>Inside a Location</td>
</tr>
<tr class="even">
<td>MONEY_B</td>
<td>Beginning of a Money amount</td>
</tr>
<tr class="odd">
<td>MONEY_I</td>
<td>Inside a Money amount</td>
</tr>
<tr class="even">
<td>NORP_B</td>
<td>Beginning of a National, Religious, or Political group</td>
</tr>
<tr class="odd">
<td>NORP_I</td>
<td>Inside a National, Religious, or Political group</td>
</tr>
<tr class="even">
<td>ORDINAL_B</td>
<td>Beginning of an Ordinal number</td>
</tr>
<tr class="odd">
<td>ORG_B</td>
<td>Beginning of an Organization</td>
</tr>
<tr class="even">
<td>ORG_I</td>
<td>Inside an Organization</td>
</tr>
<tr class="odd">
<td>PERSON_B</td>
<td>Beginning of a Person’s name</td>
</tr>
<tr class="even">
<td>PERSON_I</td>
<td>Inside a Person’s name</td>
</tr>
<tr class="odd">
<td>PRODUCT_B</td>
<td>Beginning of a Product</td>
</tr>
<tr class="even">
<td>PRODUCT_I</td>
<td>Inside a Product</td>
</tr>
<tr class="odd">
<td>QUANTITY_B</td>
<td>Beginning of a Quantity</td>
</tr>
<tr class="even">
<td>QUANTITY_I</td>
<td>Inside a Quantity</td>
</tr>
<tr class="odd">
<td>TIME_B</td>
<td>Beginning of a Time expression</td>
</tr>
<tr class="even">
<td>TIME_I</td>
<td>Inside a Time expression</td>
</tr>
<tr class="odd">
<td>WORK_OF_ART_B</td>
<td>Beginning of a Work of Art</td>
</tr>
<tr class="even">
<td>WORK_OF_ART_I</td>
<td>Inside a Work of Art</td>
</tr>
</tbody>
</table>
<p>Nice. Which products are mentioned?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(entity, <span class="st">"PRODUCT"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 61 × 9
   book             volume chapter sentence_id token_id token lemma pos   entity
   &lt;fct&gt;             &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Sense &amp; Sensibi…      1      18          58        9 Care… Care… PROPN PRODU…
 2 Sense &amp; Sensibi…      1      21           3        7 Exet… Exet… PROPN PRODU…
 3 Sense &amp; Sensibi…      1      21           3       52 Exet… Exet… PROPN PRODU…
 4 Sense &amp; Sensibi…      1      21          69       12 Exet… Exet… PROPN PRODU…
 5 Sense &amp; Sensibi…      1      21          86        4 Exet… Exet… PROPN PRODU…
 6 Sense &amp; Sensibi…      1      24          81       31 Exet… Exet… PROPN PRODU…
 7 Sense &amp; Sensibi…      1      26          38       92 Cart… cart… NOUN  PRODU…
 8 Sense &amp; Sensibi…      1      47          66       13 Exet… Exet… PROPN PRODU…
 9 Sense &amp; Sensibi…      1      49          99      101 Exet… Exet… PROPN PRODU…
10 Pride &amp; Prejudi…      1       8          34       13 Chea… Chea… PROPN PRODU…
# ℹ 51 more rows</code></pre>
</div>
</div>
<p>This is the point in our analysis where we discover that we should do something about “–”. LINK TIL TIDLIGERE, HVOR JEG NÆVNER AT HVIS IKKE VI FJERNER DEM, VIL VI SENERE OPDAGE AT DE ER ET PROBLEM.</p>
<p>FASCINERENDE NOK DUKKER My dearest Emma ikke op som produkt efter “–” er fjernet.</p>
<p>There is room for improvement in the NER. “My dearest Emma”, which appears in volume 3, chapter 13 of Emma, is probably not a product.</p>
<p>We can also note that Austen uses “–” when a new speaker starts talking. That should probably be fixed. It becomes even more apparent looking at the “PUNCT” pos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pos <span class="sc">==</span> <span class="st">"PUNCT"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(token) <span class="sc">%&gt;%</span> </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "."               ","               ";"               ":"              
 [5] "-"               "\""              "!"               "?"              
 [9] "("               ")"               "'"               "..."            
[13] "*"               "]"               "_"               "sir"            
[17] "corps"           "vivant"          "be'd"            "eclaircissement"
[21] "menus"           "la"              "second"          "interest"       
[25] "exigeant"        "...."            "patriae"         "times"          
[29] ";)"              "A'n't"          </code></pre>
</div>
</div>
<p>The named entities are recognized. But we recognize for each token. In the example above, we saw that a named entity, a product, “My dearest Emma” was recognized. Incorrectly, but the concept holds. VI SKAL HAVE ILLUSTRERET OVENFOR AT “My dearest Emma” ER ET PRODUCT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(entity, <span class="st">"PRODUCT"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Emma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(chapter <span class="sc">==</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sentence_id<span class="sc">:</span>token, entity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 4
# ℹ 4 variables: sentence_id &lt;int&gt;, token_id &lt;int&gt;, token &lt;chr&gt;, entity &lt;chr&gt;</code></pre>
</div>
</div>
<p>Looking specifically at sentence 82 in that chapter, we have recognized three entities. A product (incorrectly), an expression of time, and a person:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Emma"</span>, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>         volume <span class="sc">==</span> <span class="dv">3</span>, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>         chapter <span class="sc">==</span> <span class="dv">13</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>         sentence_id <span class="sc">==</span> <span class="dv">82</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 9
   book  volume chapter sentence_id token_id token      lemma     pos   entity
   &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;    &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; 
 1 Emma       3      13          82        1 And        and       CCONJ ""    
 2 Emma       3      13          82        2 even       even      ADV   ""    
 3 Emma       3      13          82        3 if         if        SCONJ ""    
 4 Emma       3      13          82        4 I          I         PRON  ""    
 5 Emma       3      13          82        5 have       have      AUX   ""    
 6 Emma       3      13          82        6 not        not       PART  ""    
 7 Emma       3      13          82        7 underrated underrate VERB  ""    
 8 Emma       3      13          82        8 him        he        PRON  ""    
 9 Emma       3      13          82        9 hitherto   hitherto  NOUN  ""    
10 Emma       3      13          82       10 ,          ,         PUNCT ""    
11 Emma       3      13          82       11 he         he        PRON  ""    
12 Emma       3      13          82       12 may        may       AUX   ""    
13 Emma       3      13          82       13 yet        yet       ADV   ""    
14 Emma       3      13          82       14 turn       turn      VERB  ""    
15 Emma       3      13          82       15 out        out       ADP   ""    
16 Emma       3      13          82       16 well       well      ADV   ""    
17 Emma       3      13          82       17 .          .         PUNCT ""    </code></pre>
</div>
</div>
<p>OG DENNE DUER NATURLIGVIS IKKE SOM EKSEMPEL LÆNGERE, FOR NÅR JEG FJERNER “–” ÆNDRES NUMMERERINGEN AF SÆTNINGER NATURLIGVIS OGSÅ!</p>
<p>I would now like to be able to extract these three named entities. Not as above, but as “My dearest Emma”, “hour” and “Emma”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Emma"</span>, </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>         volume <span class="sc">==</span> <span class="dv">3</span>, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>         chapter <span class="sc">==</span> <span class="dv">13</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>         sentence_id <span class="sc">==</span> <span class="dv">82</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="co"># we are not interested in empty entities</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">entitet =</span> <span class="fu">case_when</span>(</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_ends</span>(entity, <span class="st">"_B"</span>) <span class="sc">~</span> token_id, <span class="co"># TRUE if it is the beginning of a NE</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(entitet, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span> <span class="co"># Filling down - if the row contains a NE, it now contains the position of</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># the beginning of the NE</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">entity =</span> <span class="fu">str_remove</span>(entity, <span class="st">"_B|_I"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Only interested in the type of NE</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book, volume, chapter, sentence_id, entity, entitet) <span class="sc">%&gt;%</span> </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(  <span class="at">entiteten =</span> <span class="fu">paste0</span>(token, <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'book', 'volume', 'chapter', 'sentence_id',
'entity'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 7
# Groups:   book, volume, chapter, sentence_id, entity [0]
# ℹ 7 variables: book &lt;fct&gt;, volume &lt;dbl&gt;, chapter &lt;dbl&gt;, sentence_id &lt;int&gt;,
#   entity &lt;chr&gt;, entitet &lt;int&gt;, entiteten &lt;chr&gt;</code></pre>
</div>
</div>
<p>Now we should do this on the entire dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>named_entities <span class="ot">&lt;-</span> tokens <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="co"># we are not interested in empty entities</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">entitet =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_ends</span>(entity, <span class="st">"_B"</span>) <span class="sc">~</span> token_id, <span class="co"># TRUE if it is the beginning of a NE</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(entitet, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span> <span class="co"># Filling down - if the row contains a NE, it now contains the position of</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># the beginning of the NE</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">entity =</span> <span class="fu">str_remove</span>(entity, <span class="st">"_B|_I"</span>)) <span class="sc">%&gt;%</span> <span class="co"># Only interested in the type of NE</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book, volume, chapter, sentence_id, entity, entitet) <span class="sc">%&gt;%</span> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(  <span class="at">entiteten =</span> <span class="fu">paste0</span>(token, <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'book', 'volume', 'chapter', 'sentence_id',
'entity'. You can override using the `.groups` argument.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(named_entities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
# Groups:   book, volume, chapter, sentence_id, entity [6]
  book       volume chapter sentence_id entity entitet entiteten        
  &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;            
1 Persuasion      1      24          40 GPE         28 the West Indies  
2 Persuasion      1      24          40 PERSON      12 Captain Wentworth
3 Persuasion      1      24          41 PERSON       1 Mrs Smith 's     
4 Persuasion      1      24          43 PERSON      16 Anne             
5 Persuasion      1      24          44 PERSON       1 Anne             
6 Persuasion      1      24          47 NORP         1 Finis            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
   book             volume chapter sentence_id token_id token lemma pos   entity
   &lt;fct&gt;             &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Sense &amp; Sensibi…      1       1           1        1 The   the   DET   ""    
 2 Sense &amp; Sensibi…      1       1           1        2 fami… fami… NOUN  ""    
 3 Sense &amp; Sensibi…      1       1           1        3 of    of    ADP   ""    
 4 Sense &amp; Sensibi…      1       1           1        4 Dash… Dash… PROPN "GPE_…
 5 Sense &amp; Sensibi…      1       1           1        5 had   have  AUX   ""    
 6 Sense &amp; Sensibi…      1       1           1        6 long  long  ADV   ""    
 7 Sense &amp; Sensibi…      1       1           1        7 been  be    AUX   ""    
 8 Sense &amp; Sensibi…      1       1           1        8 sett… sett… VERB  ""    
 9 Sense &amp; Sensibi…      1       1           1        9 in    in    ADP   ""    
10 Sense &amp; Sensibi…      1       1           1       10 Suss… Suss… PROPN "GPE_…</code></pre>
</div>
</div>
</section>
<section id="comparing-vocabulary" class="level1">
<h1>Comparing vocabulary</h1>
<p>Når jeg tæller ord her, tæller jeg i virkeligheden tokens. Og de er ikke alle rent faktisk ord…</p>
<p>Så jeg skal have pillet de tokens ud der faktisk er ord.</p>
<p>Hvordan får jeg fat på de ord der kun bliver brugt i en af bøgerne?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tokens %&gt;% </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(word = str_to_lower(token)) %&gt;% </span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;% </span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(word) %&gt;% </span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(word)</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(word_count = n())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ordfrekvenser" class="level1">
<h1>ordfrekvenser</h1>
<p>Hvad er, efter vi har fjernet stopord, de 5 hyppigste adjektiver i bøgerne? Hvilke ord er de fem hyppigste navneord? Adverbier, udsagnsord?</p>
</section>
<section id="sentiment" class="level1">
<h1>Sentiment</h1>
<section id="afinn" class="level2">
<h2 class="anchored" data-anchor-id="afinn">afinn</h2>
<p>Rolling aggregates operate in a fixed width window. You won’t find them in base R or in dplyr, but there are many implementations in other packages, such as RcppRoll.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>AFINN <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="at">lexicon =</span> <span class="st">"afinn"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(AFINN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [2,477 × 2] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ word : chr [1:2477] "abandon" "abandoned" "abandons" "abducted" ...
 $ value: num [1:2477] -2 -2 -2 -2 -2 -2 -3 -3 -3 -3 ...
 - attr(*, "spec")=
  .. cols(
  ..   word = col_character(),
  ..   value = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>ikke meget nyttig:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(AFINN, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"token"</span> <span class="ot">=</span> <span class="st">"word"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book, volume, chapter, sentence_id) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sentiment =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(rækkefølge <span class="ot">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rækkefølge, <span class="at">y =</span> sentiment)) <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>book, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'book', 'volume', 'chapter'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="austen_R_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'zoo' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Vedhæfter pakke: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>De følgende objekter er maskerede fra 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: pakke 'data.table' blev bygget under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Vedhæfter pakke: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>De følgende objekter er maskerede fra 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>De følgende objekter er maskerede fra 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Det følgende objekt er maskeret fra 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(AFINN, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"token"</span> <span class="ot">=</span> <span class="st">"word"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book, volume, chapter, sentence_id) <span class="sc">%&gt;%</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sentiment =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span> </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(rækkefølge <span class="ot">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(book) <span class="sc">%&gt;%</span> </span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rolling_sentiment =</span> <span class="fu">frollmean</span>(sentiment, n, <span class="at">na.rm =</span>T )) <span class="sc">%&gt;%</span> </span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Emma"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(rækkefølge, rolling_sentiment)) <span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'book', 'volume', 'chapter'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 99 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="austen_R_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>der må være en enklere måde…</p>
<p>Hvordan med de andre sentiment ordlister?</p>
</section>
<section id="bing" class="level2">
<h2 class="anchored" data-anchor-id="bing">bing</h2>
</section>
<section id="loughran" class="level2">
<h2 class="anchored" data-anchor-id="loughran">loughran</h2>
<p>##nrc</p>
</section>
</section>
<section id="hvornår-dukker-karaktererne-op" class="level1">
<h1>Hvornår dukker karaktererne op?</h1>
<p>det er vist noget i retning af hvor mange sætninger optræder en karakter i - som andel af antal sætninger pr kapitel.</p>
</section>
<section id="karakter-netværk" class="level1">
<h1>karakter netværk</h1>
<p>Hm…</p>
</section>
<section id="lokationer" class="level1">
<h1>lokationer</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>named_entities <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity <span class="sc">==</span> <span class="st">"WORK_OF_ART"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 162 × 7
# Groups:   book, volume, chapter, sentence_id, entity [162]
   book                volume chapter sentence_id entity      entitet entiteten 
   &lt;fct&gt;                &lt;dbl&gt;   &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;     
 1 Sense &amp; Sensibility      1       5          34 WORK_OF_ART       2 Dear      
 2 Sense &amp; Sensibility      1      13         109 WORK_OF_ART       2 Yes , Mar…
 3 Sense &amp; Sensibility      1      14          33 WORK_OF_ART       4 Improve   
 4 Sense &amp; Sensibility      1      16          35 WORK_OF_ART       2 Months    
 5 Sense &amp; Sensibility      1      18          69 WORK_OF_ART       2 Shall I t…
 6 Sense &amp; Sensibility      1      22          98 WORK_OF_ART       2 Pardon me 
 7 Sense &amp; Sensibility      1      23          56 WORK_OF_ART      24 Your Lady…
 8 Sense &amp; Sensibility      1      23          65 WORK_OF_ART      17 Dear litt…
 9 Sense &amp; Sensibility      1      30          67 WORK_OF_ART       2 Dear ma'am
10 Sense &amp; Sensibility      1      30         130 WORK_OF_ART       2 Dear Ma'am
# ℹ 152 more rows</code></pre>
</div>
</div>
</section>
<section id="produkter" class="level1">
<h1>produkter?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>word in context</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>